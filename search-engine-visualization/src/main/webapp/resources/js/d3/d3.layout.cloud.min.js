(function(){function I(){var a=[256,256],t=R,d=S,l=T,e=E,x=E,z=U,L=V,M=F,y=[],N=Infinity,O=d3.dispatch("word","end"),A=null,u={start:function(){function J(){for(var J=+new Date,f;+new Date-J<N&&++K<E&&A;){f=Q[K];f.x=a[0]*(Math.random()+.5)>>1;f.y=a[1]*(Math.random()+.5)>>1;a:{var b=f,c=Q,m=K;if(!b.sprite){p.clearRect(0,0,(B<<5)/w,G/w);var d=0,v=0,e=0,q=c.length;for(--m;++m<q;){b=c[m];p.save();p.font=b.style+" "+b.weight+" "+~~((b.size+1)/w)+"px "+b.font;var k=p.measureText(b.text+"m").width*w,r=b.size<<
1;if(b.rotate)var n=Math.sin(b.rotate*P),t=Math.cos(b.rotate*P),h=k*t,g=k*n,t=r*t,k=r*n,k=Math.max(Math.abs(h+k),Math.abs(h-k))+31>>5<<5,r=~~Math.max(Math.abs(g+t),Math.abs(g-t));else k=k+31>>5<<5;r>e&&(e=r);d+k>=B<<5&&(d=0,v+=e,e=0);if(v+r>=G)break;p.translate((d+(k>>1))/w,(v+(r>>1))/w);b.rotate&&p.rotate(b.rotate*P);p.fillText(b.text,0,0);b.padding&&(p.lineWidth=2*b.padding,p.strokeText(b.text,0,0));p.restore();b.width=k;b.height=r;b.xoff=d;b.yoff=v;b.x1=k>>1;b.y1=r>>1;b.x0=-b.x1;b.y0=-b.y1;b.hasText=
!0;d+=k}e=p.getImageData(0,0,(B<<5)/w,G/w).data;for(q=[];0<=--m;)if(b=c[m],b.hasText){k=b.width;h=k>>5;r=b.y1-b.y0;for(g=0;g<r*h;g++)q[g]=0;d=b.xoff;if(null==d)break a;for(var v=b.yoff,n=0,t=-1,l=0;l<r;l++){for(g=0;g<k;g++){var x=e[(v+l)*(B<<5)+(d+g)<<2]?1<<31-g%32:0;q[h*l+(g>>5)]|=x;n|=x}n?t=l:(b.y0++,r--,l--,v++)}b.y1=b.y0+t;b.sprite=q.slice(0,(b.y1-b.y0)*h)}}}if(b=f.hasText)a:{b=I;c=f;m=C;d=c.x;v=c.y;k=Math.sqrt(a[0]*a[0]+a[1]*a[1]);r=M(a);e=.5>Math.random()?1:-1;q=-e;for(g=h=g=void 0;g=r(q+=e);){h=
~~g[0];g=~~g[1];if(Math.min(h,g)>k)break;c.x=d+h;c.y=v+g;if(!(h=0>c.x+c.x0||0>c.y+c.y0||c.x+c.x1>a[0]||c.y+c.y1>a[1])&&(h=m))b:{for(var h=a[0],h=h>>5,g=c.sprite,n=c.width>>5,D=c.x-(n<<4),t=D&127,l=32-t,x=c.y1-c.y0,D=(c.y+c.y0)*h+(D>>5),y=void 0,z=0;z<x;z++){for(var H=y=0;H<=n;H++)if((y<<l|(H<n?(y=g[z*n+H])>>>t:0))&b[D+H]){h=!0;break b}D+=h}h=!1}if(!h&&(!m||c.x+c.x1>m[0].x&&c.x+c.x0<m[1].x&&c.y+c.y1>m[0].y&&c.y+c.y0<m[1].y)){m=c.sprite;d=c.width>>5;v=a[0]>>5;q=c.x-(d<<4);k=q&127;r=32-k;e=c.y1-c.y0;
q=(c.y+c.y0)*v+(q>>5);for(g=0;g<e;g++){for(n=h=0;n<=d;n++)b[q+n]=b[q+n]|h<<r|(n<d?(h=m[g*d+n])>>>k:0);q+=v}delete c.sprite;b=!0;break a}}b=!1}b&&(F.push(f),O.word(f),C?(b=f,c=C[0],m=C[1],b.x+b.x0<c.x&&(c.x=b.x+b.x0),b.y+b.y0<c.y&&(c.y=b.y+b.y0),b.x+b.x1>m.x&&(m.x=b.x+b.x1),b.y+b.y1>m.y&&(m.y=b.y+b.y1)):C=[{x:f.x+f.x0,y:f.y+f.y0},{x:f.x+f.x1,y:f.y+f.y1}],f.x-=a[0]>>1,f.y-=a[1]>>1)}K>=E&&(u.stop(),O.end(F,C))}var I=W((a[0]>>5)*a[1]),C=null,E=y.length,K=-1,F=[],Q=y.map(function(a,f){a.text=t.call(this,
a,f);a.font=d.call(this,a,f);a.style=e.call(this,a,f);a.weight=x.call(this,a,f);a.rotate=z.call(this,a,f);a.size=~~l.call(this,a,f);a.padding=L.call(this,a,f);return a}).sort(function(a,d){return d.size-a.size});A&&clearInterval(A);A=setInterval(J,0);J();return u},stop:function(){A&&(clearInterval(A),A=null);return u},timeInterval:function(a){if(!arguments.length)return N;N=null==a?Infinity:a;return u},words:function(a){if(!arguments.length)return y;y=a;return u},size:function(d){if(!arguments.length)return a;
a=[+d[0],+d[1]];return u},font:function(a){if(!arguments.length)return d;d=d3.functor(a);return u},fontStyle:function(a){if(!arguments.length)return e;e=d3.functor(a);return u},fontWeight:function(a){if(!arguments.length)return x;x=d3.functor(a);return u},rotate:function(a){if(!arguments.length)return z;z=d3.functor(a);return u},text:function(a){if(!arguments.length)return t;t=d3.functor(a);return u},spiral:function(a){if(!arguments.length)return M;M=X[a+""]||a;return u},fontSize:function(a){if(!arguments.length)return l;
l=d3.functor(a);return u},padding:function(a){if(!arguments.length)return L;L=d3.functor(a);return u}};return d3.rebind(u,O,"on")}function R(a){return a.text}function S(){return"serif"}function E(){return"normal"}function T(a){return Math.sqrt(a.value)}function U(){return 30*(~~(6*Math.random())-3)}function V(){return 1}function F(a){var e=a[0]/a[1];return function(a){return[e*(a*=.1)*Math.cos(a),a*Math.sin(a)]}}function W(a){for(var e=[],d=-1;++d<a;)e[d]=0;return e}var P=Math.PI/180,B=64,G=2048,
e,w=1;"undefined"!==typeof document?(e=document.createElement("canvas"),e.width=1,e.height=1,w=Math.sqrt(e.getContext("2d").getImageData(0,0,1,1).data.length>>2),e.width=(B<<5)/w,e.height=G/w):e=new Canvas(B<<5,G);var p=e.getContext("2d"),X={archimedean:F,rectangular:function(a){var e=4*a[0]/a[1],d=0,l=0;return function(a){var p=0>a?-1:1;switch(Math.sqrt(1+4*p*a)-p&3){case 0:d+=e;break;case 1:l+=4;break;case 2:d-=e;break;default:l-=4}return[d,l]}}};p.fillStyle=p.strokeStyle="red";p.textAlign="center";
"object"===typeof module&&module.exports?module.exports=I:(d3.layout||(d3.layout={})).cloud=I})();

//Word cloud layout by Jason Davies, http://www.jasondavies.com/word-cloud/
//Algorithm due to Jonathan Feinberg, http://static.mrfeinberg.com/bv_ch03.pdf

/*
* License
*/

//Copyright (c) 2013, Jason Davies.
//All rights reserved.
//
//Redistribution and use in source and binary forms, with or without
//modification, are permitted provided that the following conditions are met:
//
//* Redistributions of source code must retain the above copyright notice, this
// list of conditions and the following disclaimer.
//
//* Redistributions in binary form must reproduce the above copyright notice,
// this list of conditions and the following disclaimer in the documentation
// and/or other materials provided with the distribution.
//
//* The name Jason Davies may not be used to endorse or promote products
// derived from this software without specific prior written permission.
//
//THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
//ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
//WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
//DISCLAIMED. IN NO EVENT SHALL JASON DAVIES BE LIABLE FOR ANY DIRECT, INDIRECT,
//INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
//LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
//PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
//LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
//OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
//ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.